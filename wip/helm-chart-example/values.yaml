# --- Configuración de la Aplicación ---
replicaCount: 2

image:
  # Imagen de un exporter de nginx para Prometheus, para que tengamos métricas que scrapear.
  repository: nginx/nginx-prometheus-exporter
  pullPolicy: IfNotPresent
  tag: "0.11"

# Define el nombre de la aplicación, que se usará en etiquetas y selectores.
# Es importante que sea consistente.
appName: "app-example"

resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# --- Configuración de Red ---
service:
  type: ClusterIP
  # Puerto principal de la aplicación (el exporter escucha en el 9113)
  port: 9113
  # Nombre del puerto para el ServiceMonitor
  metricsPortName: metrics

# --- Configuración de Exposición Externa (Ingress/ALB) ---
ingress:
  enabled: true
  hostname: "app-example.isbe.cloud" # <-- REEMPLAZAR con un dominio real
  annotations:
    # --- Anotaciones Clave para AWS Load Balancer Controller ---
    # Define la clase de Ingress como 'alb'
    kubernetes.io/ingress.class: "alb"
    # Define el esquema del balanceador (público)
    alb.ingress.kubernetes.io/scheme: "internet-facing"
    # Usa 'ip' como tipo de destino para la integración con EKS
    alb.ingress.kubernetes.io/target-type: "ip"
    # Redirige todo el tráfico HTTP a HTTPS
    alb.ingress.kubernetes.io/actions.ssl-redirect: '{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}'
    # ARN del certificado ACM que se usará para HTTPS
    # alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:REGION:ACCOUNT_ID:certificate/CERT_ID"
    # Puertos en los que escuchará el ALB
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'


# --- Configuración de Observabilidad ---
observability:
  # Activa la creación del ServiceMonitor y PrometheusRule
  enabled: true
  # Ruta desde la que Prometheus recogerá las métricas
  scrapePath: /metrics

  # Configuración del Dashboard de Grafana
  dashboard:
    enabled: true

# --- Configuración de Backups ---
velero:
  schedule:
    # Activa la creación de un Schedule de Velero
    enabled: true
    # Frecuencia del backup en formato cron (todos los días a las 3 AM UTC)
    cron: "0 3 * * *"
    # Tiempo de retención para cada backup (7 días)
    ttl: "168h0m0s"